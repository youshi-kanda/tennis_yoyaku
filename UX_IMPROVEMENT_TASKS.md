# UX改善タスクリスト

## 📊 現状システムの分析

### 現在の仕様

#### 監視機能の制約
1. **日付指定**: 1日のみ固定（例: 2025-02-15）
2. **時間帯**: ハードコード（09:00-11:00, 11:00-13:00...など6枠固定）
3. **施設選択**: 地区全体のみ（品川区全施設 or 港区全施設）
4. **監視間隔**: 5分固定（Cron: */5 * * * *）
5. **自動予約**: ON/OFF のみ
6. **予約戦略**: 'all'（全て予約）or 'priority'（優先順位）の2択

#### データ構造（MonitoringTarget）
```typescript
interface MonitoringTarget {
  id: string;
  userId: string;
  site: 'shinagawa' | 'minato';
  facilityId: string;          // 施設ID（1つのみ）
  facilityName: string;
  date: string;                 // 1日のみ（例: "2025-02-15"）
  timeSlot: string;             // 1枠のみ（例: "09:00-11:00"）
  status: 'active' | 'completed';
  autoReserve: boolean;
  createdAt: number;
  lastStatus?: string;
  lastCheck?: number;
}
```

### 問題点

1. **柔軟性の欠如**
   - 複数日を一度に監視できない
   - 希望時間帯をカスタマイズできない
   - 特定のコートだけ監視できない

2. **ユーザビリティ**
   - UI表示と実装の不一致（「翌日以降」と表示されるが実際は1日のみ）
   - 時間帯が平日・休日で固定されている想定だが変更不可
   - 地区全体監視のみで無駄が多い

3. **スケーラビリティ**
   - 1日1施設1時間帯 = 1監視ターゲット
   - 24施設 × 6時間帯 = 144ターゲット（非効率）

---

## 🎯 UX改善タスク（優先度順）

### 🔴 Priority 1: 監視設定の柔軟化

#### Task 1.1: 期間指定機能
**現状**: 1日のみ固定  
**改善**: 期間指定（開始日〜終了日）

**実装内容**:
- MonitoringTarget に `dateRange` 追加
  ```typescript
  dateRange: {
    start: string;  // "2025-02-01"
    end: string;    // "2025-02-28"
  }
  ```
- UI: カレンダーで期間選択（react-daterangepicker等）
- Backend: Cronで日付範囲内かチェック
- 期待効果: 1ヶ月分を1回の設定で監視可能

**工数**: 中（2-3日）

---

#### Task 1.2: 時間帯カスタマイズ
**現状**: 6枠固定（09:00-21:00を2時間刻み）  
**改善**: ユーザーが希望時間帯を選択

**実装内容**:
- MonitoringTarget に `timeSlots: string[]` 追加
- UI: チェックボックスで複数時間帯選択
  ```
  □ 09:00-11:00
  □ 11:00-13:00
  ☑ 17:00-19:00  ← 夕方のみ選択可能
  ☑ 19:00-21:00
  ```
- 時間帯プリセット機能
  - 「朝（9-13時）」
  - 「昼（11-17時）」
  - 「夕方以降（17-21時）」
  - 「全時間帯」
- 期待効果: 不要な時間帯の監視を削減、KV使用量削減

**工数**: 小（1-2日）

---

#### Task 1.3: 施設個別選択
**現状**: 地区全体のみ（品川区全施設 or 港区全施設）  
**改善**: 特定コート・施設のみ監視可能

**実装内容**:
- UI: 施設リストで個別選択
  ```
  品川区
  ☑ しながわ中央公園コートA
  ☑ しながわ中央公園コートB
  □ 東品川海上公園コートA
  □ 東品川海上公園コートB
  
  港区
  □ 有栖川宮記念公園コート
  □ 青山公園コート
  ...
  ```
- フィルター機能
  - 「お気に入りのみ」
  - 「屋外/屋内」
  - 「最寄り駅」
- 期待効果: 本当に必要な施設のみ監視、KV使用量大幅削減

**工数**: 中（2-3日）

---

### 🟡 Priority 2: 予約戦略の強化

#### Task 2.1: 優先順位設定
**現状**: 'all' or 'priority' の2択のみ  
**改善**: 施設・時間帯ごとに優先順位を数値で設定

**実装内容**:
- 優先度スコア（1-5）
  ```
  施設A 17:00-19:00 → 優先度5（最優先）
  施設B 09:00-11:00 → 優先度3（普通）
  施設C 全時間帯   → 優先度1（第3候補）
  ```
- 空きが複数見つかった場合、優先度順に予約
- UI: ドラッグ&ドロップで順位変更

**工数**: 中（3-4日）

---

#### Task 2.2: 曜日別設定
**現状**: 平日・休日の区別なし  
**改善**: 曜日ごとに異なる設定

**実装内容**:
- 曜日別の時間帯設定
  ```
  平日: 17:00-21:00のみ（仕事終わり）
  土日祝: 09:00-21:00（終日OK）
  ```
- 期待効果: より実際の利用パターンに合わせた監視

**工数**: 中（2-3日）

---

#### Task 2.3: 予約上限設定
**現状**: 制限なし（全て予約してしまう可能性）  
**改善**: 週/月の予約上限を設定

**実装内容**:
- 設定例
  - 「週に2回まで」
  - 「月に8回まで」
- 上限到達時は監視継続するが予約は停止
- 通知: 「上限に達したため予約をスキップしました」

**工数**: 小（1-2日）

---

### 🟢 Priority 3: 通知・UI改善

#### Task 3.1: リアルタイム通知強化
**現状**: プッシュ通知の実装が不完全（TODO状態）  
**改善**: 確実な通知システム

**実装内容**:
- プッシュ通知の完全実装
- メール通知オプション（重要な場合）
- 通知設定
  - 空き検出時
  - 予約成功時
  - 予約失敗時
  - 毎日のサマリー

**工数**: 中（2-3日）

---

#### Task 3.2: 監視状況の可視化
**現状**: 監視リストのみ  
**改善**: ダッシュボードで詳細把握

**実装内容**:
- カレンダービュー
  - 監視中の日付を色分け表示
  - 予約済みの枠を表示
- タイムラインビュー
  - 最近の空き検出履歴
  - 予約成功/失敗の履歴
- 統計グラフ
  - 時間帯別の空き検出率
  - 施設別の成功率

**工数**: 大（4-5日）

---

#### Task 3.3: モバイルアプリ最適化
**現状**: PWAだがモバイル体験が不十分  
**改善**: スマホファースト設計

**実装内容**:
- タッチ操作の最適化
- オフライン対応強化
- ホーム画面追加の誘導
- 通知許可のスムーズな取得

**工数**: 中（3-4日）

---

### 🔵 Priority 4: データ管理・分析

#### Task 4.1: 監視テンプレート機能
**現状**: 毎回設定が必要  
**改善**: よく使う設定を保存・再利用

**実装内容**:
- テンプレート保存
  ```
  テンプレート名: 「平日夕方（品川）」
  - 施設: しながわ中央A/B
  - 時間: 17:00-21:00
  - 曜日: 月-金
  ```
- ワンクリックで適用
- 期待効果: 設定の手間を大幅削減

**工数**: 小（1-2日）

---

#### Task 4.2: 予約分析レポート
**現状**: 基本的な統計のみ  
**改善**: 詳細な分析機能

**実装内容**:
- 週次/月次レポート
  - 最も空きやすい施設
  - 最も空きやすい時間帯
  - 競合率（×→○への変化頻度）
- おすすめ提案
  - 「施設Aは火曜17時が狙い目です」

**工数**: 中（2-3日）

---

#### Task 4.3: データエクスポート
**現状**: UI内でしか見られない  
**改善**: CSVダウンロード機能

**実装内容**:
- 予約履歴をCSV出力
- 監視ログをCSV出力
- 期待効果: 外部での分析・記録保存

**工数**: 小（1日）

---

### 🟣 Priority 5: パフォーマンス・信頼性

#### Task 5.1: 監視間隔の最適化
**現状**: 5分固定  
**改善**: 時間帯に応じて可変

**実装内容**:
- 重要時間帯（3:15, 5:00前後）: 1分間隔
- 通常時間: 5分間隔
- 深夜: 10分間隔
- 期待効果: KV使用量の削減と精度向上の両立

**工数**: 小（1-2日）

---

#### Task 5.2: エラーハンドリング強化
**現状**: エラー時の対応が不明確  
**改善**: リトライ・フォールバック機能

**実装内容**:
- 自動リトライ（最大3回）
- セッション切れ時の自動再ログイン
- エラー通知とログ記録
- 期待効果: 信頼性向上

**工数**: 中（2-3日）

---

#### Task 5.3: テスト環境の構築
**現状**: 本番のみ  
**改善**: ステージング環境

**実装内容**:
- テスト用の別Workers環境
- モックサーバーでスクレイピングをシミュレート
- 自動テストの追加
- 期待効果: 安全なリリースプロセス

**工数**: 中（3-4日）

---

## 📋 実装優先順位まとめ

### Phase 1: 基本的な柔軟化（1-2週間）
1. ✅ Task 1.2: 時間帯カスタマイズ（最も簡単で効果大）
2. ✅ Task 1.3: 施設個別選択（KV削減効果大）
3. ✅ Task 4.1: 監視テンプレート（UX向上）

### Phase 2: 高度な機能（2-3週間）
4. ✅ Task 1.1: 期間指定機能（ユーザー要望が強い）
5. ✅ Task 2.1: 優先順位設定（予約の質向上）
6. ✅ Task 3.1: 通知強化（現在TODO状態）

### Phase 3: 分析・最適化（2-3週間）
7. ✅ Task 3.2: 可視化ダッシュボード（UX大幅向上）
8. ✅ Task 5.1: 監視間隔最適化（パフォーマンス）
9. ✅ Task 4.2: 予約分析レポート（付加価値）

### Phase 4: 長期改善（継続的）
10. Task 2.2: 曜日別設定
11. Task 5.2: エラーハンドリング
12. Task 5.3: テスト環境

---

## 🎨 UI/UXの改善ポイント

### 現在の問題
1. **誤解を招く表記**
   - 「翌日以降の空き枠を継続的にチェック」
   - 実際は指定した1日のみ

2. **設定の複雑さ**
   - 施設単位で登録が必要
   - 時間帯が選べない

3. **情報不足**
   - 監視間隔が不明
   - どれくらい前から監視すべきか分からない

### 改善後のUI例

```
┌─────────────────────────────────────────┐
│ 🎾 新しい監視を追加                      │
├─────────────────────────────────────────┤
│                                         │
│ 📅 監視期間                             │
│ ○ 1日のみ                               │
│ ● 期間指定  [2/1] 〜 [2/28]  (28日間)  │
│ ○ 継続監視（停止するまで）              │
│                                         │
│ 🏢 施設選択                             │
│ ▼ 品川区 (2件選択中)                    │
│   ☑ しながわ中央公園コートA             │
│   ☑ しながわ中央公園コートB             │
│   □ 東品川海上公園コートA               │
│   □ 東品川海上公園コートB               │
│                                         │
│ ⏰ 希望時間帯                           │
│ □ 09:00-11:00  □ 11:00-13:00          │
│ □ 13:00-15:00  □ 15:00-17:00          │
│ ☑ 17:00-19:00  ☑ 19:00-21:00          │
│ 💡 プリセット: [朝] [昼] [夕方] [全て] │
│                                         │
│ 🎯 予約設定                             │
│ ☑ 自動予約を有効化                      │
│ 優先順位: [高 ●────────○ 低]           │
│                                         │
│ ℹ️ この設定で約XXX施設×時間帯を監視     │
│ 5分ごとにチェック、空きを即座に検知     │
│                                         │
│ [テンプレートとして保存]  [監視開始]    │
└─────────────────────────────────────────┘
```

---

## 📊 期待効果

### KV使用量削減
- **現状**: 24施設 × 6時間帯 × 288回/日 = 約40,000操作
- **改善後**: 必要な施設・時間のみ → 約5,000操作（87%削減）

### ユーザー満足度
- 設定時間: 10分 → 2分（80%削減）
- 予約成功率: 推定向上（希望条件に絞るため）
- 利便性: 大幅向上（柔軟な設定が可能）

---

## 🚀 次のアクション

1. **Phase 1の着手決定**（今週）
   - Task 1.2（時間帯カスタマイズ）
   - Task 1.3（施設個別選択）

2. **ユーザーヒアリング**
   - 実際の利用パターン確認
   - 優先機能の絞り込み

3. **プロトタイプ作成**
   - 新UI のモックアップ
   - ユーザーフィードバック取得

現状のPhase 2（KV検証）が完了次第、これらのUX改善に着手しますか？
